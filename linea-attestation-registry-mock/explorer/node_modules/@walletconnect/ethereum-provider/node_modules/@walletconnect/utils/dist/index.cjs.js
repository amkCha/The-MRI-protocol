"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var le=require("@stablelib/chacha20poly1305"),vn=require("@stablelib/hkdf"),de=require("@stablelib/random"),W=require("@stablelib/sha256"),En=require("@stablelib/x25519"),l=require("uint8arrays"),Nn=require("detect-browser"),C=require("@walletconnect/time"),_=require("@walletconnect/window-getters"),bn=require("@walletconnect/window-metadata"),On=require("query-string"),Sn=require("@walletconnect/relay-api");function pe(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var fe=pe(En),K=pe(On);const L=":";function me(e){const[n,t]=e.split(L);return{namespace:n,reference:t}}function ge(e){const{namespace:n,reference:t}=e;return[n,t].join(L)}function G(e){const[n,t,r]=e.split(L);return{namespace:n,reference:t,address:r}}function ye(e){const{namespace:n,reference:t,address:r}=e;return[n,t,r].join(L)}function J(e,n){const t=[];return e.forEach(r=>{const o=n(r);t.includes(o)||t.push(o)}),t}function he(e){const{address:n}=G(e);return n}function ve(e){const{namespace:n,reference:t}=G(e);return ge({namespace:n,reference:t})}function Rn(e,n){const{namespace:t,reference:r}=me(n);return ye({namespace:t,reference:r,address:e})}function In(e){return J(e,he)}function Ee(e){return J(e,ve)}function Tn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...o.accounts)}),t}function An(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...Ee(o.accounts))}),t}function wn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...q(r,o))}),t}function q(e,n){return e.includes(":")?[e]:n.chains||[]}const F=e=>e?.split(":"),Ne=e=>{const n=e&&F(e);if(n)return n[3]},Pn=e=>{const n=e&&F(e);if(n)return n[2]+":"+n[3]},be=e=>{const n=e&&F(e);if(n)return n.pop()},Cn=(e,n)=>{const t=`${e.domain} wants you to sign in with your Ethereum account:`,r=be(n),o=e.statement,s=`URI: ${e.aud}`,i=`Version: ${e.version}`,p=`Chain ID: ${Ne(n)}`,d=`Nonce: ${e.nonce}`,a=`Issued At: ${e.iat}`,u=e.resources&&e.resources.length>0?`Resources:
${e.resources.map(c=>`- ${c}`).join(`
`)}`:void 0;return[t,r,"",o,"",s,i,p,d,a,u].filter(c=>c!=null).join(`
`)},Q="base10",m="base16",x="base64pad",H="utf8",Z=0,U=1,_n=0,Oe=1,X=12,ee=32;function Un(){const e=fe.generateKeyPair();return{privateKey:l.toString(e.secretKey,m),publicKey:l.toString(e.publicKey,m)}}function Dn(){const e=de.randomBytes(ee);return l.toString(e,m)}function jn(e,n){const t=fe.sharedKey(l.fromString(e,m),l.fromString(n,m),!0),r=new vn.HKDF(W.SHA256,t).expand(ee);return l.toString(r,m)}function Vn(e){const n=W.hash(l.fromString(e,m));return l.toString(n,m)}function $n(e){const n=W.hash(l.fromString(e,H));return l.toString(n,m)}function Se(e){return l.fromString(`${e}`,Q)}function V(e){return Number(l.toString(e,Q))}function Mn(e){const n=Se(typeof e.type<"u"?e.type:Z);if(V(n)===U&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof e.senderPublicKey<"u"?l.fromString(e.senderPublicKey,m):void 0,r=typeof e.iv<"u"?l.fromString(e.iv,m):de.randomBytes(X),o=new le.ChaCha20Poly1305(l.fromString(e.symKey,m)).seal(r,l.fromString(e.message,H));return Re({type:n,sealed:o,iv:r,senderPublicKey:t})}function kn(e){const n=new le.ChaCha20Poly1305(l.fromString(e.symKey,m)),{sealed:t,iv:r}=ne(e.encoded),o=n.open(r,t);if(o===null)throw new Error("Failed to decrypt");return l.toString(o,H)}function Re(e){if(V(e.type)===U){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return l.toString(l.concat([e.type,e.senderPublicKey,e.iv,e.sealed]),x)}return l.toString(l.concat([e.type,e.iv,e.sealed]),x)}function ne(e){const n=l.fromString(e,x),t=n.slice(_n,Oe),r=Oe;if(V(t)===U){const p=r+ee,d=p+X,a=n.slice(r,p),u=n.slice(p,d),c=n.slice(d);return{type:t,sealed:c,iv:u,senderPublicKey:a}}const o=r+X,s=n.slice(r,o),i=n.slice(o);return{type:t,sealed:i,iv:s}}function Kn(e,n){const t=ne(e);return Ie({type:V(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?l.toString(t.senderPublicKey,m):void 0,receiverPublicKey:n?.receiverPublicKey})}function Ie(e){const n=e?.type||Z;if(n===U){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:n,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function Ln(e){return e.type===U&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}var qn=Object.defineProperty,Te=Object.getOwnPropertySymbols,Fn=Object.prototype.hasOwnProperty,xn=Object.prototype.propertyIsEnumerable,Ae=(e,n,t)=>n in e?qn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,we=(e,n)=>{for(var t in n||(n={}))Fn.call(n,t)&&Ae(e,t,n[t]);if(Te)for(var t of Te(n))xn.call(n,t)&&Ae(e,t,n[t]);return e};const Pe="ReactNative",g={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},B=" ",Hn=":",Ce="/",te=2,Bn=1e3,_e="js";function re(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function D(){return!_.getDocument()&&!!_.getNavigator()&&navigator.product===Pe}function $(){return!re()&&!!_.getNavigator()&&!!_.getDocument()}function A(){return D()?g.reactNative:re()?g.node:$()?g.browser:g.unknown}function zn(){var e;try{return D()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Ue(e,n){let t=K.parse(e);return t=we(we({},t),n),e=K.stringify(t),e}function Yn(){return bn.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Wn(e,n){var t;const r=A(),o={protocol:e,version:n,env:r};return r==="browser"&&(o.host=((t=_.getLocation())==null?void 0:t.host)||"unknown"),o}function De(){if(A()===g.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:r}=global.Platform;return[t,r].join("-")}const e=Nn.detect();if(e===null)return"unknown";const n=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[n,e.name,e.version].join("-"):[n,e.version].join("-")}function je(){var e;const n=A();return n===g.browser?[n,((e=_.getLocation())==null?void 0:e.host)||"unknown"].join(":"):n}function Ve(e,n,t){const r=De(),o=je();return[[e,n].join("-"),[_e,t].join("-"),r,o].join("/")}function Gn({protocol:e,version:n,relayUrl:t,sdkVersion:r,auth:o,projectId:s,useOnCloseEvent:i,bundleId:p}){const d=t.split("?"),a=Ve(e,n,r),u={auth:o,ua:a,projectId:s,useOnCloseEvent:i||void 0,origin:p||void 0},c=Ue(d[1]||"",u);return d[0]+"?"+c}function Jn(e){let n=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const t=typeof n<"u"?e.split("://")[1]:e;return n=n==="wss"?"https":"http",[n,t].join("://")}function Qn(e,n,t){if(!e[n]||typeof e[n]!==t)throw new Error(`Missing or invalid "${n}" param`)}function $e(e,n=te){return Me(e.split(Ce),n)}function Zn(e){return $e(e).join(B)}function b(e,n){return e.filter(t=>n.includes(t)).length===e.length}function Me(e,n=te){return e.slice(Math.max(e.length-n,0))}function Xn(e){return Object.fromEntries(e.entries())}function et(e){return new Map(Object.entries(e))}function nt(e,n){const t={};return Object.keys(e).forEach(r=>{t[r]=n(e[r])}),t}const tt=e=>e;function ke(e){return e.trim().replace(/^\w/,n=>n.toUpperCase())}function rt(e){return e.split(B).map(n=>ke(n)).join(B)}function ot(e=C.FIVE_MINUTES,n){const t=C.toMiliseconds(e||C.FIVE_MINUTES);let r,o,s;return{resolve:i=>{s&&r&&(clearTimeout(s),r(i))},reject:i=>{s&&o&&(clearTimeout(s),o(i))},done:()=>new Promise((i,p)=>{s=setTimeout(()=>{p(new Error(n))},t),r=i,o=p})}}function st(e,n,t){return new Promise(async(r,o)=>{const s=setTimeout(()=>o(new Error(t)),n);try{const i=await e;r(i)}catch(i){o(i)}clearTimeout(s)})}function oe(e,n){if(typeof n=="string"&&n.startsWith(`${e}:`))return n;if(e.toLowerCase()==="topic"){if(typeof n!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${n}`}else if(e.toLowerCase()==="id"){if(typeof n!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${n}`}throw new Error(`Unknown expirer target type: ${e}`)}function it(e){return oe("topic",e)}function at(e){return oe("id",e)}function ct(e){const[n,t]=e.split(":"),r={id:void 0,topic:void 0};if(n==="topic"&&typeof t=="string")r.topic=t;else if(n==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${n}:${t}`);return r}function ut(e,n){return C.fromMiliseconds((n||Date.now())+C.toMiliseconds(e))}function lt(e){return Date.now()>=C.toMiliseconds(e)}function dt(e,n){return`${e}${n?`:${n}`:""}`}function O(e=[],n=[]){return[...new Set([...e,...n])]}async function pt({id:e,topic:n,wcDeepLink:t}){try{if(!t)return;const r=typeof t=="string"?JSON.parse(t):t;let o=r?.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const s=`${o}/wc?requestId=${e}&sessionTopic=${n}`,i=A();i===g.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):i===g.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(r){console.error(r)}}async function ft(e,n){try{return await e.getItem(n)||($()?localStorage.getItem(n):void 0)}catch(t){console.error(t)}}const Ke="irn";function mt(e){return e?.relay||{protocol:Ke}}function gt(e){const n=Sn.RELAY_JSONRPC[e];if(typeof n>"u")throw new Error(`Relay Protocol not supported: ${e}`);return n}var yt=Object.defineProperty,Le=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,qe=(e,n,t)=>n in e?yt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Et=(e,n)=>{for(var t in n||(n={}))ht.call(n,t)&&qe(e,t,n[t]);if(Le)for(var t of Le(n))vt.call(n,t)&&qe(e,t,n[t]);return e};function Fe(e,n="-"){const t={},r="relay"+n;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),i=e[o];t[s]=i}}),t}function Nt(e){e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const n=e.indexOf(":"),t=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,n),o=e.substring(n+1,t).split("@"),s=typeof t<"u"?e.substring(t):"",i=K.parse(s);return{protocol:r,topic:xe(o[0]),version:parseInt(o[1],10),symKey:i.symKey,relay:Fe(i)}}function xe(e){return e.startsWith("//")?e.substring(2):e}function He(e,n="-"){const t="relay",r={};return Object.keys(e).forEach(o=>{const s=t+n+o;e[o]&&(r[s]=e[o])}),r}function bt(e){return`${e.protocol}:${e.topic}@${e.version}?`+K.stringify(Et({symKey:e.symKey},He(e.relay)))}var Ot=Object.defineProperty,St=Object.defineProperties,Rt=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,It=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,ze=(e,n,t)=>n in e?Ot(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,At=(e,n)=>{for(var t in n||(n={}))It.call(n,t)&&ze(e,t,n[t]);if(Be)for(var t of Be(n))Tt.call(n,t)&&ze(e,t,n[t]);return e},wt=(e,n)=>St(e,Rt(n));function w(e){const n=[];return e.forEach(t=>{const[r,o]=t.split(":");n.push(`${r}:${o}`)}),n}function Ye(e){const n=[];return Object.values(e).forEach(t=>{n.push(...w(t.accounts))}),n}function We(e,n){const t=[];return Object.values(e).forEach(r=>{w(r.accounts).includes(n)&&t.push(...r.methods)}),t}function Ge(e,n){const t=[];return Object.values(e).forEach(r=>{w(r.accounts).includes(n)&&t.push(...r.events)}),t}function Pt(e,n){const t=sn(e,n);if(t)throw new Error(t.message);const r={};for(const[o,s]of Object.entries(e))r[o]={methods:s.methods,events:s.events,chains:s.accounts.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)};return r}function Ct(e){const{proposal:{requiredNamespaces:n,optionalNamespaces:t={}},supportedNamespaces:r}=e,o=ie(n),s=ie(t),i={};Object.keys(r).forEach(a=>{const u=r[a].chains,c=r[a].methods,E=r[a].events,R=r[a].accounts;u.forEach(y=>{if(!R.some(f=>f.includes(y)))throw new Error(`No accounts provided for chain ${y} in namespace ${a}`)}),i[a]={chains:u,methods:c,events:E,accounts:R}});const p=cn(n,i,"approve()");if(p)throw new Error(p.message);const d={};return!Object.keys(n).length&&!Object.keys(t).length?i:(Object.keys(o).forEach(a=>{const u=r[a].chains.filter(y=>{var f,v;return(v=(f=o[a])==null?void 0:f.chains)==null?void 0:v.includes(y)}),c=r[a].methods.filter(y=>{var f,v;return(v=(f=o[a])==null?void 0:f.methods)==null?void 0:v.includes(y)}),E=r[a].events.filter(y=>{var f,v;return(v=(f=o[a])==null?void 0:f.events)==null?void 0:v.includes(y)}),R=u.map(y=>r[a].accounts.filter(f=>f.includes(`${y}:`))).flat();d[a]={chains:u,methods:c,events:E,accounts:R}}),Object.keys(s).forEach(a=>{var u,c,E,R,y,f;if(!r[a])return;const v=(c=(u=s[a])==null?void 0:u.chains)==null?void 0:c.filter(I=>r[a].chains.includes(I)),gn=r[a].methods.filter(I=>{var T,j;return(j=(T=s[a])==null?void 0:T.methods)==null?void 0:j.includes(I)}),yn=r[a].events.filter(I=>{var T,j;return(j=(T=s[a])==null?void 0:T.events)==null?void 0:j.includes(I)}),hn=v?.map(I=>r[a].accounts.filter(T=>T.includes(`${I}:`))).flat();d[a]={chains:O((E=d[a])==null?void 0:E.chains,v),methods:O((R=d[a])==null?void 0:R.methods,gn),events:O((y=d[a])==null?void 0:y.events,yn),accounts:O((f=d[a])==null?void 0:f.accounts,hn)}}),d)}function se(e){return e.includes(":")}function Je(e){return se(e)?e.split(":")[0]:e}function ie(e){var n,t,r;const o={};if(!z(e))return o;for(const[s,i]of Object.entries(e)){const p=se(s)?[s]:i.chains,d=i.methods||[],a=i.events||[],u=Je(s);o[u]=wt(At({},o[u]),{chains:O(p,(n=o[u])==null?void 0:n.chains),methods:O(d,(t=o[u])==null?void 0:t.methods),events:O(a,(r=o[u])==null?void 0:r.events)})}return o}const Qe={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Ze={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function N(e,n){const{message:t,code:r}=Ze[e];return{message:n?`${t} ${n}`:t,code:r}}function P(e,n){const{message:t,code:r}=Qe[e];return{message:n?`${t} ${n}`:t,code:r}}function M(e,n){return Array.isArray(e)?typeof n<"u"&&e.length?e.every(n):!0:!1}function z(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function S(e){return typeof e>"u"}function h(e,n){return n&&S(e)?!0:typeof e=="string"&&!!e.trim().length}function Y(e,n){return n&&S(e)?!0:typeof e=="number"&&!isNaN(e)}function _t(e,n){const{requiredNamespaces:t}=n,r=Object.keys(e.namespaces),o=Object.keys(t);let s=!0;return b(o,r)?(r.forEach(i=>{const{accounts:p,methods:d,events:a}=e.namespaces[i],u=w(p),c=t[i];(!b(q(i,c),u)||!b(c.methods,d)||!b(c.events,a))&&(s=!1)}),s):!1}function k(e){return h(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function Xe(e){if(h(e,!1)&&e.includes(":")){const n=e.split(":");if(n.length===3){const t=n[0]+":"+n[1];return!!n[2]&&k(t)}}return!1}function Ut(e){if(h(e,!1))try{return typeof new URL(e)<"u"}catch{return!1}return!1}function Dt(e){var n;return(n=e?.proposer)==null?void 0:n.publicKey}function jt(e){return e?.topic}function Vt(e,n){let t=null;return h(e?.publicKey,!1)||(t=N("MISSING_OR_INVALID",`${n} controller public key should be a string`)),t}function ae(e){let n=!0;return M(e)?e.length&&(n=e.every(t=>h(t,!1))):n=!1,n}function en(e,n,t){let r=null;return M(n)&&n.length?n.forEach(o=>{r||k(o)||(r=P("UNSUPPORTED_CHAINS",`${t}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):k(e)||(r=P("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function nn(e,n,t){let r=null;return Object.entries(e).forEach(([o,s])=>{if(r)return;const i=en(o,q(o,s),`${n} ${t}`);i&&(r=i)}),r}function tn(e,n){let t=null;return M(e)?e.forEach(r=>{t||Xe(r)||(t=P("UNSUPPORTED_ACCOUNTS",`${n}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=P("UNSUPPORTED_ACCOUNTS",`${n}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function rn(e,n){let t=null;return Object.values(e).forEach(r=>{if(t)return;const o=tn(r?.accounts,`${n} namespace`);o&&(t=o)}),t}function on(e,n){let t=null;return ae(e?.methods)?ae(e?.events)||(t=P("UNSUPPORTED_EVENTS",`${n}, events should be an array of strings or empty array for no events`)):t=P("UNSUPPORTED_METHODS",`${n}, methods should be an array of strings or empty array for no methods`),t}function ce(e,n){let t=null;return Object.values(e).forEach(r=>{if(t)return;const o=on(r,`${n}, namespace`);o&&(t=o)}),t}function $t(e,n,t){let r=null;if(e&&z(e)){const o=ce(e,n);o&&(r=o);const s=nn(e,n,t);s&&(r=s)}else r=N("MISSING_OR_INVALID",`${n}, ${t} should be an object with data`);return r}function sn(e,n){let t=null;if(e&&z(e)){const r=ce(e,n);r&&(t=r);const o=rn(e,n);o&&(t=o)}else t=N("MISSING_OR_INVALID",`${n}, namespaces should be an object with data`);return t}function an(e){return h(e.protocol,!0)}function Mt(e,n){let t=!1;return n&&!e?t=!0:e&&M(e)&&e.length&&e.forEach(r=>{t=an(r)}),t}function kt(e){return typeof e=="number"}function Kt(e){return typeof e<"u"&&typeof e!==null}function Lt(e){return!(!e||typeof e!="object"||!e.code||!Y(e.code,!1)||!e.message||!h(e.message,!1))}function qt(e){return!(S(e)||!h(e.method,!1))}function Ft(e){return!(S(e)||S(e.result)&&S(e.error)||!Y(e.id,!1)||!h(e.jsonrpc,!1))}function xt(e){return!(S(e)||!h(e.name,!1))}function Ht(e,n){return!(!k(n)||!Ye(e).includes(n))}function Bt(e,n,t){return h(t,!1)?We(e,n).includes(t):!1}function zt(e,n,t){return h(t,!1)?Ge(e,n).includes(t):!1}function cn(e,n,t){let r=null;const o=Yt(e),s=Wt(n),i=Object.keys(o),p=Object.keys(s),d=un(Object.keys(e)),a=un(Object.keys(n)),u=d.filter(c=>!a.includes(c));return u.length&&(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(n).toString()}`)),b(i,p)||(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${i.toString()}
      Approved: ${p.toString()}`)),Object.keys(n).forEach(c=>{if(!c.includes(":")||r)return;const E=w(n[c].accounts);E.includes(c)||(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${c}
        Required: ${c}
        Approved: ${E.toString()}`))}),i.forEach(c=>{r||(b(o[c].methods,s[c].methods)?b(o[c].events,s[c].events)||(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${c}`)):r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${c}`))}),r}function Yt(e){const n={};return Object.keys(e).forEach(t=>{var r;t.includes(":")?n[t]=e[t]:(r=e[t].chains)==null||r.forEach(o=>{n[o]={methods:e[t].methods,events:e[t].events}})}),n}function un(e){return[...new Set(e.map(n=>n.includes(":")?n.split(":")[0]:n))]}function Wt(e){const n={};return Object.keys(e).forEach(t=>{if(t.includes(":"))n[t]=e[t];else{const r=w(e[t].accounts);r?.forEach(o=>{n[o]={accounts:e[t].accounts.filter(s=>s.includes(`${o}:`)),methods:e[t].methods,events:e[t].events}})}}),n}function Gt(e,n){return Y(e,!1)&&e<=n.max&&e>=n.min}function Jt(){const e=A();return new Promise(n=>{switch(e){case g.browser:n(ln());break;case g.reactNative:n(dn());break;case g.node:n(pn());break;default:n(!0)}})}function ln(){return $()&&navigator?.onLine}async function dn(){if(D()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function pn(){return!0}function Qt(e){switch(A()){case g.browser:fn(e);break;case g.reactNative:mn(e);break;case g.node:break}}function fn(e){!D()&&$()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function mn(e){D()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(n=>e(n?.isConnected))}const ue={};class Zt{static get(n){return ue[n]}static set(n,t){ue[n]=t}static delete(n){delete ue[n]}}exports.BASE10=Q,exports.BASE16=m,exports.BASE64=x,exports.COLON=Hn,exports.DEFAULT_DEPTH=te,exports.EMPTY_SPACE=B,exports.ENV_MAP=g,exports.INTERNAL_ERRORS=Ze,exports.MemoryStore=Zt,exports.ONE_THOUSAND=Bn,exports.REACT_NATIVE_PRODUCT=Pe,exports.RELAYER_DEFAULT_PROTOCOL=Ke,exports.SDK_ERRORS=Qe,exports.SDK_TYPE=_e,exports.SLASH=Ce,exports.TYPE_0=Z,exports.TYPE_1=U,exports.UTF8=H,exports.appendToQueryString=Ue,exports.assertType=Qn,exports.buildApprovedNamespaces=Ct,exports.calcExpiry=ut,exports.capitalize=rt,exports.capitalizeWord=ke,exports.createDelayedPromise=ot,exports.createExpiringPromise=st,exports.decodeTypeByte=V,exports.decrypt=kn,exports.deriveSymKey=jn,exports.deserialize=ne,exports.encodeTypeByte=Se,exports.encrypt=Mn,exports.engineEvent=dt,exports.enumify=tt,exports.formatAccountId=ye,exports.formatAccountWithChain=Rn,exports.formatChainId=ge,exports.formatExpirerTarget=oe,exports.formatIdTarget=at,exports.formatMessage=Cn,exports.formatMessageContext=Zn,exports.formatRelayParams=He,exports.formatRelayRpcUrl=Gn,exports.formatTopicTarget=it,exports.formatUA=Ve,exports.formatUri=bt,exports.generateKeyPair=Un,exports.generateRandomBytes32=Dn,exports.getAccountsChains=w,exports.getAccountsFromNamespaces=Tn,exports.getAddressFromAccount=he,exports.getAddressesFromAccounts=In,exports.getAppMetadata=Yn,exports.getBrowserOnlineStatus=ln,exports.getBundleId=zn,exports.getChainFromAccount=ve,exports.getChainsFromAccounts=Ee,exports.getChainsFromNamespace=q,exports.getChainsFromNamespaces=An,exports.getChainsFromRequiredNamespaces=wn,exports.getDeepLink=ft,exports.getDidAddress=be,exports.getDidAddressSegments=F,exports.getDidChainId=Ne,exports.getEnvironment=A,exports.getHttpUrl=Jn,exports.getInternalError=N,exports.getJavascriptID=je,exports.getJavascriptOS=De,exports.getLastItems=Me,exports.getNamespacedDidChainId=Pn,exports.getNamespacesChains=Ye,exports.getNamespacesEventsForChainId=Ge,exports.getNamespacesMethodsForChainId=We,exports.getNodeOnlineStatus=pn,exports.getReactNativeOnlineStatus=dn,exports.getRelayClientMetadata=Wn,exports.getRelayProtocolApi=gt,exports.getRelayProtocolName=mt,exports.getRequiredNamespacesFromNamespaces=Pt,exports.getSdkError=P,exports.getUniqueValues=J,exports.handleDeeplinkRedirect=pt,exports.hasOverlap=b,exports.hashKey=Vn,exports.hashMessage=$n,exports.isBrowser=$,exports.isCaipNamespace=se,exports.isConformingNamespaces=cn,exports.isExpired=lt,exports.isNode=re,exports.isOnline=Jt,exports.isProposalStruct=Dt,exports.isReactNative=D,exports.isSessionCompatible=_t,exports.isSessionStruct=jt,exports.isTypeOneEnvelope=Ln,exports.isUndefined=S,exports.isValidAccountId=Xe,exports.isValidAccounts=tn,exports.isValidActions=on,exports.isValidArray=M,exports.isValidChainId=k,exports.isValidChains=en,exports.isValidController=Vt,exports.isValidErrorReason=Lt,exports.isValidEvent=xt,exports.isValidId=kt,exports.isValidNamespaceAccounts=rn,exports.isValidNamespaceActions=ce,exports.isValidNamespaceChains=nn,exports.isValidNamespaceMethodsOrEvents=ae,exports.isValidNamespaces=sn,exports.isValidNamespacesChainId=Ht,exports.isValidNamespacesEvent=zt,exports.isValidNamespacesRequest=Bt,exports.isValidNumber=Y,exports.isValidObject=z,exports.isValidParams=Kt,exports.isValidRelay=an,exports.isValidRelays=Mt,exports.isValidRequest=qt,exports.isValidRequestExpiry=Gt,exports.isValidRequiredNamespaces=$t,exports.isValidResponse=Ft,exports.isValidString=h,exports.isValidUrl=Ut,exports.mapEntries=nt,exports.mapToObj=Xn,exports.mergeArrays=O,exports.normalizeNamespaces=ie,exports.objToMap=et,exports.parseAccountId=G,exports.parseChainId=me,exports.parseContextNames=$e,exports.parseExpirerTarget=ct,exports.parseNamespaceKey=Je,exports.parseRelayParams=Fe,exports.parseTopic=xe,exports.parseUri=Nt,exports.serialize=Re,exports.subscribeToBrowserNetworkChange=fn,exports.subscribeToNetworkChange=Qt,exports.subscribeToReactNativeNetworkChange=mn,exports.validateDecoding=Kn,exports.validateEncoding=Ie;
//# sourceMappingURL=index.cjs.js.map
